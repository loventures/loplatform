/*
 * LO Platform copyright (C) 2007â€“2025 LO Ventures LLC.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

import classNames from 'classnames';
import Course from '../bootstrap/course';
import { isIframe } from '../bootstrap/session';
import User from '../bootstrap/user';
import { ERLandmark } from '../landmarks/ERLandmarkProvider';
import dayjs from 'dayjs';
import { useTranslation } from '../i18n/translationContext';
import { lOFooter, logoBrandingLO } from '../utilities/preferences';
import React, { useMemo } from 'react';

const currentYear = dayjs().format('YYYY');
const interpolateFooterUrl = (originalUrl: string) => {
  return originalUrl
    .replace('{{sectionId}}', Course.externalId || 'null')
    .replace('{{userId}}', User.externalId || 'null');
};

const isMeek = !!Course.contentItemRoot;

const AppFooter: React.FC<{ className?: string }> = ({ className }) => {
  const translate = useTranslation();

  const transparent = useMemo(() => isMeek && isIframe(), []);

  const configuredLinks = useMemo(
    () =>
      window.lo_platform?.footer?.objects?.map(link => ({
        title: link.title,
        url: interpolateFooterUrl(link.url),
        newWindow: link.newWindow,
      })),
    []
  );

  return (
    <ERLandmark
      landmark="appFooter"
      tag="footer"
      className={classNames('app-footer content-width', className, {
        'transparent-mode': transparent,
      })}
    >
      <div className="footer-content">
        {/*Custom configured per domain links.*/}
        {lOFooter && configuredLinks && (
          <ul className="lo-footer-links list-unstyled d-print-none">
            {configuredLinks.map(link => (
              <li
                className="lo-footer-link"
                key={link.url}
              >
                <a
                  target={link.newWindow ? '_blank' : '_self'}
                  href={link.url}
                  rel="noopener"
                >
                  {link.title}
                </a>
              </li>
            ))}
          </ul>
        )}

        <div className="lo-footer-copyright">
          <span className="lo-footer-copytext">
            &copy;{translate('LOCopyRight', { date: currentYear })}
          </span>
        </div>
      </div>

      {logoBrandingLO && (
        <a
          className="lo-footer-logo d-none d-lg-block"
          href="https://www.learningobjects.com/"
          target="_blank"
          rel="noopener"
          title={translate('Powered by LO Ventures')}
          tabIndex={-1}
        >
          <svg
            fill="currentColor"
            strokeWidth={0}
            width="105"
            height="16"
            viewBox="0 0 5489.6445 835.58398"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g transform="translate(-461.896,-1460.04)">
              <path
                d="m 461.896,2141 v -59.392 h 138.24 V 1519.432 H 468.04 v -59.392 h 206.848 v 621.568 H 812.104 V 2141 Z"
                style={{ fill: '#3e6cd7' }}
              />
              <path
                d="m 1148.998,2149.192 q -63.488,0 -112.64,-30.72 -48.12795,-31.744 -75.77595,-86.016 -27.648,-55.296 -27.648,-125.952 0,-71.68 27.648,-125.952 27.648,-55.296 75.77595,-86.016 49.152,-31.744 112.64,-31.744 63.488,0 111.616,31.744 49.152,30.72 76.8,86.016 27.648,54.272 27.648,125.952 0,70.656 -27.648,125.952 -27.648,54.272 -76.8,86.016 -48.128,30.72 -111.616,30.72 z m 0,-61.44 q 40.96,0 71.68,-23.552 30.72,-23.552 48.128,-64.512 18.432,-40.96 18.432,-94.208 0,-53.248 -18.432,-94.208 -17.408,-40.96 -48.128,-63.488 -30.72,-23.552 -71.68,-23.552 -39.936,0 -71.68,23.552 -30.72,22.528 -49.152,63.488 -17.408,40.96 -17.408,94.208 0,53.248 17.408,94.208 18.432,40.96 49.152,64.512 31.744,23.552 71.68,23.552 z"
                style={{ fill: '#3e6cd7' }}
              />
              <path
                d="m 1627.2041,2295.624 v -822.272 h 68.608 v 822.272 z"
                style={{ fill: '#b7b7b7' }}
              />
              <path d="m 2143.2981,2141 -185.344,-467.968 h 73.728 l 151.552,384 h -14.336 l 82.944,-190.464 q 24.576,-56.32 38.912,-104.448 15.36,-48.128 22.528,-89.088 h 69.632 q -8.192,43.008 -25.6,94.208 -17.408,51.2 -43.008,110.592 L 2200.6421,2141 Z" />
              <path d="m 2707.5202,2151.24 q -51.2,0 -93.184,-15.36 -41.984,-16.384 -72.704,-47.104 -29.696,-30.72 -46.08,-75.776 -16.384,-46.08 -16.384,-104.448 0,-59.392 16.384,-105.472 17.408,-46.08 46.08,-76.8 29.696,-31.744 68.608,-48.128 39.936,-16.384 83.968,-16.384 39.936,0 74.752,13.312 34.816,13.312 60.416,40.96 25.6,26.624 39.936,68.608 15.36,41.984 15.36,99.328 0,8.192 -1.024,17.408 0,8.192 -1.024,16.384 h -332.8 q 2.048,45.056 15.36,78.848 13.312,32.768 34.816,54.272 21.504,20.48 49.152,30.72 28.672,10.24 60.416,10.24 24.576,0 46.08,-5.12 21.504,-6.144 39.936,-17.408 19.456,-12.288 34.816,-29.696 l 40.96,39.936 q -19.456,23.552 -45.056,39.936 -24.576,16.384 -54.272,23.552 -29.696,8.192 -64.512,8.192 z m -154.624,-290.816 h 257.024 q 0,-32.768 -9.216,-58.368 -8.192,-26.624 -24.576,-45.056 -15.36,-19.456 -37.888,-28.672 -21.504,-10.24 -49.152,-10.24 -24.576,0 -47.104,8.192 -21.504,8.192 -39.936,26.624 -18.432,17.408 -31.744,44.032 -12.288,26.624 -17.408,63.488 z" />
              <path d="m 3014.7182,2141 v -467.968 h 71.68 v 82.944 q 18.432,-28.672 43.008,-49.152 24.576,-21.504 54.272,-32.768 29.696,-12.288 61.44,-12.288 38.912,0 69.632,19.456 30.72,19.456 49.152,62.464 18.432,43.008 18.432,113.664 V 2141 h -71.68 v -281.6 q 0,-49.152 -11.264,-77.824 -11.264,-29.696 -30.72,-41.984 -19.456,-13.312 -44.032,-13.312 -23.552,0 -48.128,10.24 -23.552,10.24 -44.032,29.696 -20.48,18.432 -33.792,45.056 -12.288,26.624 -12.288,60.416 V 2141 Z" />
              <path d="m 3759.1643,2148.168 q -45.056,0 -73.728,-15.36 -28.672,-15.36 -44.032,-47.104 -15.36,-32.768 -20.48,-81.92 -4.096,-49.152 -2.048,-116.736 l 12.288,-333.824 76.8,-9.216 10.24,-1.024 1.024,7.168 q -5.12,7.168 -9.216,14.336 -3.072,7.168 -5.12,24.576 l -9.216,115.712 3.072,18.432 -7.168,168.96 q -3.072,77.824 4.096,120.832 7.168,41.984 25.6,58.368 18.432,15.36 49.152,15.36 33.792,0 59.392,-13.312 26.624,-13.312 55.296,-33.792 l 22.528,58.368 q -34.816,25.6 -71.68,37.888 -36.864,12.288 -76.8,12.288 z m -234.496,-475.136 h 336.896 v 60.416 h -336.896 z" />
              <path d="m 4191.2903,2152.264 q -27.648,0 -52.224,-8.192 -24.576,-8.192 -45.056,-24.576 -19.456,-17.408 -33.792,-43.008 -14.336,-25.6 -22.528,-61.44 -7.168,-35.84 -7.168,-80.896 l 1.024,-261.12 h 71.68 v 261.12 q 0,44.032 8.192,74.752 8.192,30.72 22.528,49.152 15.36,18.432 34.816,26.624 19.456,8.192 40.96,8.192 24.576,0 47.104,-9.216 22.528,-10.24 39.936,-29.696 18.432,-19.456 28.672,-50.176 10.24,-30.72 10.24,-72.704 v -258.048 h 71.68 v 395.264 q 0,18.432 1.024,36.864 2.048,17.408 9.216,35.84 h -70.656 q -5.12,-12.288 -7.168,-23.552 -2.048,-12.288 -3.072,-24.576 0,-12.288 0,-23.552 -11.264,19.456 -26.624,34.816 -15.36,15.36 -34.816,26.624 -18.432,10.24 -39.936,15.36 -20.48,6.144 -44.032,6.144 z" />
              <path d="m 4598.8404,1673.032 h 76.8 l -3.072,136.192 -9.216,-15.36 q 6.144,-31.744 21.504,-56.32 15.36,-24.576 36.864,-40.96 21.504,-17.408 47.104,-25.6 25.6,-9.216 53.248,-9.216 36.864,0 67.584,13.312 31.744,12.288 56.32,37.888 l -32.768,57.344 -4.096,9.216 -7.168,-4.096 q -2.048,-8.192 -6.144,-15.36 -4.096,-7.168 -17.408,-17.408 -16.384,-10.24 -30.72,-13.312 -13.312,-4.096 -30.72,-4.096 -25.6,0 -51.2,10.24 -25.6,9.216 -47.104,29.696 -20.48,20.48 -32.768,52.224 -12.288,31.744 -12.288,75.776 v 248.832 h -74.752 z" />
              <path d="m 5267.5104,2151.24 q -51.2,0 -93.184,-15.36 -41.984,-16.384 -72.704,-47.104 -29.696,-30.72 -46.08,-75.776 -16.384,-46.08 -16.384,-104.448 0,-59.392 16.384,-105.472 17.408,-46.08 46.08,-76.8 29.696,-31.744 68.608,-48.128 39.936,-16.384 83.968,-16.384 39.936,0 74.752,13.312 34.816,13.312 60.416,40.96 25.6,26.624 39.936,68.608 15.36,41.984 15.36,99.328 0,8.192 -1.024,17.408 0,8.192 -1.024,16.384 h -332.8 q 2.048,45.056 15.36,78.848 13.312,32.768 34.816,54.272 21.504,20.48 49.152,30.72 28.672,10.24 60.416,10.24 24.576,0 46.08,-5.12 21.504,-6.144 39.936,-17.408 19.456,-12.288 34.816,-29.696 l 40.96,39.936 q -19.456,23.552 -45.056,39.936 -24.576,16.384 -54.272,23.552 -29.696,8.192 -64.512,8.192 z m -154.624,-290.816 h 257.024 q 0,-32.768 -9.216,-58.368 -8.192,-26.624 -24.576,-45.056 -15.36,-19.456 -37.888,-28.672 -21.504,-10.24 -49.152,-10.24 -24.576,0 -47.104,8.192 -21.504,8.192 -39.936,26.624 -18.432,17.408 -31.744,44.032 -12.288,26.624 -17.408,63.488 z" />
              <path d="m 5758.0045,2151.24 q -38.912,0 -74.752,-8.192 -34.816,-8.192 -66.56,-24.576 -30.72,-16.384 -57.344,-40.96 l 40.96,-69.632 6.144,-9.216 6.144,4.096 q 2.048,8.192 4.096,17.408 3.072,8.192 14.336,20.48 21.504,21.504 51.2,35.84 30.72,13.312 77.824,13.312 37.888,0 63.488,-9.216 26.624,-9.216 40.96,-25.6 14.336,-17.408 14.336,-39.936 0,-15.36 -6.144,-26.624 -6.144,-12.288 -20.48,-22.528 -13.312,-10.24 -35.84,-20.48 -22.528,-10.24 -55.296,-20.48 -53.248,-15.36 -93.184,-35.84 -39.936,-20.48 -61.44,-47.104 -21.504,-27.648 -21.504,-62.464 0,-35.84 19.456,-61.44 19.456,-26.624 57.344,-40.96 38.912,-15.36 95.232,-15.36 32.768,0 59.392,5.12 26.624,4.096 49.152,13.312 22.528,9.216 40.96,23.552 19.456,13.312 36.864,31.744 l -41.984,51.2 -7.168,8.192 -5.12,-5.12 q -1.024,-8.192 -5.12,-15.36 -3.072,-8.192 -14.336,-19.456 -23.552,-18.432 -53.248,-27.648 -29.696,-10.24 -57.344,-10.24 -40.96,0 -70.656,14.336 -29.696,14.336 -29.696,44.032 0,15.36 10.24,30.72 11.264,14.336 39.936,29.696 28.672,14.336 81.92,29.696 58.368,18.432 93.184,37.888 35.84,18.432 51.2,43.008 16.384,24.576 16.384,58.368 0,38.912 -21.504,72.704 -20.48,33.792 -63.488,54.272 -43.008,19.456 -108.544,19.456 z" />
            </g>
          </svg>
        </a>
      )}
    </ERLandmark>
  );
};

export default AppFooter;
